<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>
	<artifactId>afirma-ui-simpleafirma-webstart</artifactId>
	<packaging>jar</packaging>
	
	<name>afirma-ui-simpleafirma-webstart</name>
	<description>Envoltura para la publicacion de Autofirma como aplicacion WebStart</description>
	
	<parent>
		<groupId>es.gob.afirma</groupId>
		<artifactId>afirma-client</artifactId>
		<version>1.9</version>
	</parent>

	<properties>
		<afirma.keytool.keystore>${basedir}/afirma.keystore</afirma.keytool.keystore>
		<afirma.keytool.alias>codesign</afirma.keytool.alias>
		<afirma.keytool.password>afirma</afirma.keytool.password>
		<afirma.jar.name>AutoFirmaWS</afirma.jar.name>
		<afirma.legible.version>V${project.version}</afirma.legible.version>
		<afirma.finalName>${afirma.jar.name}__${afirma.legible.version}</afirma.finalName>
		<java.target.version>1.8</java.target.version>
	</properties>

	<profiles>

		<profile>
			<id>env-dev</id>
			<activation>
				<activeByDefault>true</activeByDefault>
	      	</activation>

			<dependencies>
				<dependency>
					 <groupId>es.gob.afirma</groupId>
					 <artifactId>afirma-ui-simpleafirma</artifactId>
					 <version>${project.version}</version>
					 <exclusions>
						<exclusion>
							<groupId>es.gob.afirma</groupId>
							<artifactId>afirma-core-massive</artifactId>
						</exclusion>
						<exclusion>
							<groupId>es.gob.afirma</groupId>
							<artifactId>afirma-keystores-capiaddressbook</artifactId>
						</exclusion>
						<exclusion>
							<groupId>com.github.markusbernhardt</groupId>
							<artifactId>proxy-vole</artifactId>
						</exclusion>
						<exclusion>
							<groupId>javax.help</groupId>
							<artifactId>javahelp</artifactId>
						</exclusion>
						<exclusion>
							<groupId>org.apache.pdfbox</groupId>
							<artifactId>pdfbox</artifactId>
						</exclusion>
						<exclusion>
							<groupId>net.java.dev.jna</groupId>
							<artifactId>jna</artifactId>
						</exclusion>
					 </exclusions>
				</dependency>
				 
				<dependency>
					 <groupId>es.gob.afirma</groupId>
					 <artifactId>afirma-ui-simpleafirma-configurator</artifactId>
					 <version>${project.version}</version>
				</dependency>

			</dependencies>
		
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-compiler-plugin</artifactId>
						<configuration>
							<source>${java.target.version}</source>
							<target>${java.target.version}</target>
							<fork>true</fork>
							<compilerArgument>-XDignore.symbol.file</compilerArgument>
						</configuration>
					</plugin>
				</plugins>
			</build>
		</profile>
	
		<!-- Perfil para la construccion de una version del MiniApplet distribuible (firmada con certificado de pruebas) -->
		<profile>
			<id>env-install</id>
			<activation>
				<property>
					<name>env</name>
					<value>install</value>
				</property>
	      	</activation>

		<dependencies>
		 <dependency>
		 	 <groupId>es.gob.afirma</groupId>
		 	 <artifactId>afirma-ui-simpleafirma</artifactId>
		 	 <version>${clienteafirma.version}</version>
		 	 <exclusions>
		 	 	<exclusion> <!-- Se omite para permitir la ofuscacion a pesar de ser necesario en Java 11 -->
					<groupId>org.apache.santuario</groupId>
				    <artifactId>xmlsec</artifactId>
		 	 	</exclusion>
		 	 	<exclusion>
		 	 		<groupId>es.gob.afirma</groupId>
					<artifactId>afirma-core-massive</artifactId>
		 	 	</exclusion>
		 	 	<exclusion>
					<groupId>es.gob.afirma</groupId>
					<artifactId>afirma-keystores-capiaddressbook</artifactId>
				</exclusion>
		 	 	<exclusion>
					<groupId>com.github.markusbernhardt</groupId>
					<artifactId>proxy-vole</artifactId>
			 	</exclusion>
			 	<exclusion>
			 		<groupId>javax.help</groupId>
					<artifactId>javahelp</artifactId>
				</exclusion>
				<exclusion>
					<groupId>org.apache.pdfbox</groupId>
					<artifactId>pdfbox</artifactId>
				</exclusion>
				<exclusion>
					<groupId>net.java.dev.jna</groupId>
					<artifactId>jna</artifactId>
				</exclusion>
		 	 </exclusions>
		 </dependency>
		 
		 <dependency>
		 	 <groupId>es.gob.afirma</groupId>
		 	 <artifactId>afirma-ui-simpleafirma-configurator</artifactId>
		 	 <version>${clienteafirma.version}</version>
		 </dependency>

		</dependencies>
		
		<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<source>${java.target.version}</source>
					<target>${java.target.version}</target>
					<fork>true</fork>
					<compilerArgument>-XDignore.symbol.file</compilerArgument>
				</configuration>
			</plugin>

			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-shade-plugin</artifactId>
				<version>3.2.1</version>
				<executions>
					<execution>
						<phase>package</phase>
						<goals>
							<goal>shade</goal>
						</goals>
						<configuration>
							<transformers>
								<transformer
									implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
									<manifestEntries>
										<Application-Name>AutoFirma</Application-Name>
										<Main-Class>es.gob.afirma.standalone.ws.AutoFirmaWebStart</Main-Class>
										<Permissions>all-permissions</Permissions>
									</manifestEntries>
								</transformer>
							</transformers>
						</configuration>
					</execution>
				</executions>
				<configuration>
					<archive>
						<addMavenDescriptor>false</addMavenDescriptor>
					</archive>
					<filters>
						<filter>
							<artifact>*:*</artifact>
							<excludes>
								<exclude>META-INF/*.SF</exclude>
								<exclude>META-INF/*.DSA</exclude>
								<exclude>META-INF/*.RSA</exclude>
								<exclude>*.crt</exclude>
							</excludes>
						</filter>
						<filter>
							<artifact>es.gob.afirma:afirma-ui-simpleafirma</artifact>
							<includes>
								<include>es/**</include>
								<include>lookandfeel/**</include>
								<include>properties/protocolmessages.properties</include>
								<include>properties/simpleafirmamessages.properties</include>
								<include>properties/updater.properties</include>
								<include>properties/preferences.properties</include>
                    			<include>resources/afirma_ico.png</include>
                    		</includes>
						</filter>
						<filter>
							<artifact>es.gob.afirma:afirma-ui-simpleafirma-configurator</artifact>
							<excludes>
								<exclude>windows/**</exclude>
								<exclude>linux/**</exclude>
								<exclude>osx/certutil.osx.zip</exclude>
							</excludes>
						</filter>
						<filter>
							<artifact>*:*</artifact>
							<excludes>
								<exclude>nss/**</exclude>
							</excludes>
						</filter>
						<filter>
							<artifact>es.uji.crypto.xades:jxades</artifact>
							<excludes>
								<exclude>TrustRootCACertificates/**</exclude>
								<exclude>*.*</exclude>
							</excludes>
						</filter>
					</filters>
				</configuration>
				
			</plugin>

			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jar-plugin</artifactId>
				<configuration>
					<finalName>${afirma.finalName}</finalName>
				</configuration>
			</plugin>

			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jarsigner-plugin</artifactId>
				<version>3.0.0</version>
				<executions>
					<execution>
						<goals>
							<goal>sign</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<keystore>${afirma.keytool.keystore}</keystore>
					<alias>${afirma.keytool.alias}</alias>
					<storepass>${afirma.keytool.password}</storepass>
					<verify>true</verify>
				</configuration>
			</plugin>
		</plugins>
	</build>
	</profile>

	
	<!--  Si usamos Java 8, ademas del perfil anterior se ejecutara este para ofuscar el codigo -->
<!-- 
    <profile>
      <id>env-install-java-8</id>
      <activation>
        <property>
          <name>env</name>
          <value>install</value>
        </property>
        <jdk>1.8</jdk>
      </activation>

	  <build>
	  	<plugins>
		  <plugin>
				<groupId>com.github.wvengen</groupId>
				<artifactId>proguard-maven-plugin</artifactId>
				<version>2.0.14</version>
				<executions>
					<execution>
						<goals>
							<goal>proguard</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<proguardVersion>5.2</proguardVersion>
					<injar>${afirma.finalName}.jar</injar>
					<outputDirectory>${project.build.directory}</outputDirectory>
					<proguardInclude>${basedir}/proguard.conf</proguardInclude>
					<libs>
						<lib>${java.home}/lib/rt.jar</lib>
						<lib>${java.home}/lib/jsse.jar</lib>
						<lib>${java.home}/lib/jce.jar</lib>
					</libs>
				</configuration>
				<dependencies>
					<dependency>
						<groupId>net.sf.proguard</groupId>
						<artifactId>proguard-base</artifactId>
						<version>5.2</version>
					</dependency>
				</dependencies>
			</plugin>
		  </plugins>
		</build>
	</profile>
	 -->


	<!-- Construccion para el despliegue como aplicacion WebStart completa, con la misma funcionalidad
	 que la aplicacion nativa (aunque no acepte las llamadas por protocolo). -->
	<profile>
			<id>compile-complete</id>
			<activation>
			 <property>
	          <name>compile</name>
	          <value>complete</value>
	         </property>
	      	</activation>

		<dependencies>
		 <dependency>
		 	 <groupId>es.gob.afirma</groupId>
		 	 <artifactId>afirma-ui-simpleafirma</artifactId>
		 	 <version>${project.version}</version>
		 </dependency>

		 <dependency>
		 	 <groupId>es.gob.afirma</groupId>
		 	 <artifactId>afirma-ui-simpleafirma-configurator</artifactId>
		 	 <version>${project.version}</version>
		 	 <scope>provided</scope>
		 </dependency>

		</dependencies>


	<build>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<configuration>
					<source>${java.target.version}</source>
					<target>${java.target.version}</target>
					<fork>true</fork>
					<compilerArgument>-XDignore.symbol.file</compilerArgument>
				</configuration>
			</plugin>

			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-shade-plugin</artifactId>
				<version>3.1.0</version>
				<executions>
					<execution>
						<phase>package</phase>
						<goals>
							<goal>shade</goal>
						</goals>
						<configuration>
							<transformers>
								<transformer
									implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
									<manifestEntries>
										<Application-Name>AutoFirma</Application-Name>
										<Main-Class>es.gob.afirma.standalone.ws.AutoFirmaWebStart</Main-Class>
										<Permissions>all-permissions</Permissions>
									</manifestEntries>
								</transformer>
							</transformers>
						</configuration>
					</execution>
				</executions>
				<configuration>
					<archive>
						<addMavenDescriptor>false</addMavenDescriptor>
					</archive>
					<filters>
						<filter>
							<artifact>*:*</artifact>
							<excludes>
								<exclude>META-INF/*.SF</exclude>
								<exclude>META-INF/*.DSA</exclude>
								<exclude>META-INF/*.RSA</exclude>
								<exclude>*.crt</exclude>
							</excludes>
						</filter>
						<filter>
							<artifact>es.gob.afirma:afirma-ui-simpleafirma</artifact>
							<excludes>
								<exclude>windows/**</exclude>
								<exclude>linux/**</exclude>
								<exclude>osx/**</exclude>
							</excludes>
						</filter>
						<filter>
							<artifact>net.java.xades:jxades</artifact>
							<excludes>
								<exclude>TrustRootCACertificates/**</exclude>
								<exclude>*.*</exclude>
							</excludes>
						</filter>
					</filters>
				</configuration>
				
			</plugin>
<!-- 
			<plugin>
				<groupId>com.github.wvengen</groupId>
				<artifactId>proguard-maven-plugin</artifactId>
				<version>2.0.13</version>
				<executions>
					<execution>
						<goals>
							<goal>proguard</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<proguardVersion>5.2</proguardVersion>
					<injar>${project.build.finalName}.jar</injar>
					<outputDirectory>${project.build.directory}</outputDirectory>
					<proguardInclude>${basedir}/proguard.conf</proguardInclude>
					<libs>
						<lib>${java.home}/lib/rt.jar</lib>
						<lib>${java.home}/lib/jsse.jar</lib>
						<lib>${java.home}/lib/jce.jar</lib>
					</libs>
				</configuration>
				<dependencies>
					<dependency>
						<groupId>net.sf.proguard</groupId>
						<artifactId>proguard-base</artifactId>
						<version>5.2</version>
					</dependency>
				</dependencies>
			</plugin>
 -->
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jar-plugin</artifactId>
				<executions>
					<execution>
						<goals>
							<goal>sign</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<keystore>${afirma.keytool.keystore}</keystore>
					<alias>${afirma.keytool.alias}</alias>
					<storepass>${afirma.keytool.password}</storepass>
					<signedjar>${project.build.directory}/${project.build.finalName}-signed.jar</signedjar>
					<verify>true</verify>
				</configuration>
			</plugin>

		</plugins>
	</build>
		</profile>

	</profiles>
</project>
